!function(i){i.fn.KyjPicker=function(e,t,a){function n(){var i=""==b.format?b.initData:b.format.split(","),e=null,t=[],a=0;for(var n in i){if(a++,null!=b.initData&&""!=b.format){e=b.initData;for(var r in e)t=e[r]}var c=p(i[n],a,t);null!=c&&v.push(c)}}function r(){i("#mDateMask").show(),i("#mDateMask").html(f());var e=i("#mDatePicker").html();for(var t in v){var a=v[t];a.bulidUI(),e+=a.ui}if(i("#mDatePicker").html(e),b.subHeight=i("#"+a.pickerName).find("ul li").height(),b.formatUnit){var n=i(".picker-flg").position().top;i(".picker-flg").css({top:n+b.subHeight}),i("#mDatePicker").height(i("#mDatePicker").height()+b.subHeight)}}function c(){i("#mDatePicker div").css({width:100/v.length+"%"})}function s(){for(var i in v){var e=v[i];e.refresh()}b.currdate&&l(new Date)}function l(i){var e=parseInt(i.getFullYear()),t=parseInt(i.getMonth())+1,a=parseInt(i.getDate()),n=parseInt(i.getHours()),r=parseInt(i.getMinutes()),c=parseInt(i.getSeconds());for(var s in v){var l=v[s];"yyyy"==l.type?l.index=e-l.min+1:"MM"==l.type?l.index=t-l.min+1:"dd"==l.type?l.index=a-l.min+1:"HH"==l.type?l.index=n-l.min+1:"mm"==l.type?l.index=r-l.min+1:"ss"==l.type&&(l.index=c-l.min+1),l.refresh()}}function m(){i("#mDatePicker .finish-btn").click(function(){i("#mDatePicker").css({bottom:"-275px"}),setTimeout('$("#mDateMask").hide()',500);var e="";for(var a in v){var n=v[a];e+=n.toText()}void 0==t?y.is("input")?y.val(e):y.html(e):t(e)})}function u(i){return new iScroll(i,{snap:"li",vScrollbar:!1,hScroll:!1,onScrollEnd:function(){var e=Math.round(this.y/-b.subHeight)+1;for(var t in v){var a=v[t];a.pickerName==i&&(a.index=e,("yyyy"==a.type||"MM"==a.type)&&o())}}})}function o(){var i,e,t,a=parseInt((new Date).getFullYear()),n=parseInt((new Date).getMonth());for(var r in v){var c=v[r];"yyyy"==c.type?(i=c,a=c.min+c.index-1):"MM"==c.type?(e=c,n=c.min+c.index-1):"dd"==c.type&&(t=c)}if(null!=t){var s=new Date(a,n,0).getDate();s!=t.max&&t.reSetMax(s)}}function p(e,t,a){var n=new Object;switch(n.type="object"==typeof e?"initData":e,n.index=1,n.type){case"yyyy":n.pickerName="yearPicker",n.min=b.beginyear,n.max=b.endyear,n.unit="年";break;case"MM":n.pickerName="monthPicker",n.min=1,n.max=12,n.unit="月";break;case"dd":n.min=1,n.max=31,n.pickerName="dayPicker",n.unit="日";break;case"am":n.ui=h(),n.min=1,n.max=2,n.pickerName="amPicker";break;case"HH":n.min=0,n.max=24,n.pickerName="hhPicker",n.unit="时";break;case"mm":n.min=0,n.max=59,n.pickerName="mmPicker",n.unit="分";break;case"ss":n.min=0,n.max=59,n.pickerName="ssPicker",n.unit="秒";break;case"initData":n.min=0,n.max=e.length-1,n.pickerName="initData"+t,n.dataList=e,n.unit="";break;case"shi":n.min=0,n.max=a.length-1,n.pickerName="shi",n.dataList=a,n.unit="室";break;case"ting":n.min=0,n.max=a.length-1,n.pickerName="ting",n.dataList=a,n.unit="厅";break;case"wei":n.min=0,n.max=a.length-1,n.pickerName="wei",n.dataList=a,n.unit="卫";break;case"chu":n.min=0,n.max=a.length-1,n.pickerName="chu",n.dataList=a,n.unit="厨";break;case"yangtai":n.min=0,n.max=a.length-1,n.pickerName="yangtai",n.dataList=a,n.unit="阳台";break;default:return null}return n.bulidUI=function(){null==n.ui&&(n.ui=d(n.pickerName,n.unit,n.min,n.max,n.dataList))},n.refresh=function(){null==n.picker&&(n.picker=u(n.pickerName)),n.picker.refresh(),n.picker.scrollTo(0,b.subHeight*(n.index-1),400,!0)},n.toText=function(){return"am"!=n.type?"initData"==n.type?n.dataList[n.min+n.index-1]+n.unit:n.min+n.index-1+n.unit:1==n.index?"上午":2==n.index?"下午":void 0},n.reSetMax=function(e){n.max=e,i("#"+n.pickerName).find("ul li").each(function(t){e+1>t?i(this).show():i(this).hide()}),i("#"+n.pickerName).find("ul li:last").show(),n.picker.refresh()},n}function k(i){var e="";switch(i){case"shi":e="室";break;case"ting":e="厅";break;case"wei":e="卫";break;case"chu":e="厨";break;case"yangtai":e="阳台";break;default:return null}return e}function f(){var i="",e=b.title;if(""!=b.format&&null!=b.initData){b.formatUnit=!0;for(var t=b.format.split(","),a=0;a<t.length;a++)i+="<span class='unitSpan' style=width:"+1/t.length*100+"%>"+k(t[a])+"</span>";return'<div id = "mDatePicker"><section class="picker-tool"><h2>'+e+'</h2><span class = "picker-flg"></span><p class= "finish-btn">完成</p></section><section class="picker-unit">'+i+"</section></div>"}return'<div id = "mDatePicker"><section class="picker-tool"><h2>'+e+'</h2><span class = "picker-flg"></span><p class= "finish-btn">完成</p></section></div>'}function d(i,e,t,a,n){var r="";r+="<div id= "+i+"><ul><li>&nbsp;</li>";for(var c=t;a>=c;c++)r+=""==b.format?"<li>"+n[c]+e+"</li>":""!=b.format&&null!=b.initData?"<li>"+c+"</li>":"<li>"+c+e+"</li>";return r+"<li>&nbsp;</li></ul></div>"}function h(){return"<div id='amPicker'><ul><li>&nbsp;</li><li>上午</li><li>下午</li><li >&nbsp;</li></ul></div>"}var y=i(this),v=new Array;i.fn.KyjPicker.defaultOptions={title:"",format:"",initData:null,beginyear:1970,endyear:2050,startyear:2015,currdate:!1,subHeight:0,formatUnit:!1};var b=i.extend(!0,{},i.fn.KyjPicker.defaultOptions,e);n(),r(),c(),s(),m(),i("#mDatePicker").css({bottom:"0"})}}(jQuery);